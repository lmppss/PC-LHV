# -*- coding: utf-8 -*-
"""Untitled0.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1ZkgJpsrPLf54vXV3wMqcJXu2RLl27OGj
"""

import streamlit as st
import numpy as np
import pandas as pd
import joblib
import datetime
import pytz
import plotly.express as px
import os

# Cargar el modelo .pkl
modelo = joblib.load("PC_0.8722_12.04.pkl")

# Archivo temporal para guardar predicciones
historial_path = "historial_predicciones.csv"
if not os.path.exists(historial_path):
    pd.DataFrame(columns=["FechaHora", "Cenizas", "PC"]).to_csv(historial_path, index=False)

# T铆tulo de la app
st.title(" Predicci贸n del Poder Calor铆fico del Carb贸n")
st.markdown("Ingrese los datos manualmente o pegue una fila completa separada por **coma, espacio o tabulaci贸n**.")

# Opci贸n de entrada r谩pida
st.subheader(" Entrada r谩pida (una l铆nea completa)")
entrada_linea = st.text_input("Pegue aqu铆 una fila completa con los 11 valores en orden:")

# Bot贸n para activar la entrada manual
mostrar_entrada_manual = st.button(" Mostrar entrada manual")

# Si se presiona el bot贸n, se muestran los campos de entrada manual
if mostrar_entrada_manual:
    cenizas_bs = st.number_input("Cenizas (BS) (%)", min_value=0.0)
    sio2 = st.number_input("SiO2 ash (%)", min_value=0.0)
    al2o3 = st.number_input("Al2O3 ash (%)", min_value=0.0)
    fe2o3 = st.number_input("Fe2O3 ash (%)", min_value=0.0)
    cao = st.number_input("CaO ash (%)", min_value=0.0)
    mgo = st.number_input("MgO ash (%)", min_value=0.0)
    so3 = st.number_input("SO3 ash (%)", min_value=0.0)
    na2o = st.number_input("Na2O ash (%)", min_value=0.0)
    k2o = st.number_input("K2O ash (%)", min_value=0.0)
    s_carbon = st.number_input("S carb贸n (%)", min_value=0.0)
    cl_carbon = st.number_input("Cl carb贸n (%)", min_value=0.0)

# Bot贸n de predicci贸n
if st.button(" Predecir Poder Calor铆fico"):
    if entrada_linea:
        # Detectar separador
        if "," in entrada_linea:
            sep = ","
        elif "\t" in entrada_linea:
            sep = "\t"
        else:
            sep = " "
        try:
            valores = list(map(float, entrada_linea.strip().split(sep)))
            if len(valores) != 11:
                st.error("锔 Debe ingresar exactamente 11 valores.")
                st.stop()
        except:
            st.error("锔 Error en el formato de la l铆nea pegada.")
            st.stop()
    else:
        valores = [cenizas_bs, sio2, al2o3, fe_]()